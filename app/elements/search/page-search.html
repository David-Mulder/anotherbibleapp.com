<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="./bible-search.html">
<link rel="import" href="./topical-search.html">

<dom-module id="page-search">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host{

        background: var(--primary-color-50);

        position: absolute;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
        display: flex;
        flex-direction: column;
      }
      .search-box {
        background-color: #fff;
        border: 1px solid #eee;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        height: 40px;
        max-width: 800px;
        margin: auto;
        @apply(--layout-flex);
        @apply(--layout-center);
        @apply(--layout-horizontal);
      }

      .search-box iron-icon {
        color: var(--google-grey-700);
        fill: var(--google-grey-700);
        margin: 0 8px;
      }

      .search-box input {
        font-size: 20px;
        outline: 0;
        border: none;
      }

      .content {
        overflow:auto;
        padding: 0px 10px;
        flex:1;
      }
      .search-box input {
        @apply(--layout-flex);
      }
      .instructions{
        max-width: 800px;
        margin: auto;
        margin-top: 30px;
        text-align: center;
        color: var(--secondary-text-on-background-color)
      }
    </style>

    <paper-toolbar class="medium-tall">
      <intelligent-title no-title-if-wide></intelligent-title>
      <div class="search-box bottom">
        <iron-icon icon="search"></iron-icon>
        <input is="iron-input" value="{{searchQuery}}" on-keyup="_setValueIfEnter" x-webkit-speech autofocus></input>
        <iron-icon icon="av:mic"></iron-icon>
      </div>
    </paper-toolbar>

    <div class="content">
      <div class="instructions" hidden$="{{searchStarted}}">
        Enter your search query above. To search in a specific book use <code>in:Matthew</code>
      </div>
      <div hidden$="{{!searchStarted}}">
        <topical-search search-query="{{searchQuery}}" on-no-results="triggerBibleSearch"></topical-search>
        <bible-search id="bibleSearch" search-query="{{searchQuery}}"></bible-search>
      </div>
    </div>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'page-search',

        properties: {
          searchQuery: {
            type: String,
            notify: true
          },
          searchStarted: {
            type: Boolean,
            value: false
          }
        },

        _setValueIfEnter: function(ev){
          if(ev.keyCode == 13){
            ev.target.blur();
            this.searchQuery = ev.target.value;
            this.searchStarted = true;
          }
        },

        triggerBibleSearch: function(){
          this.$.bibleSearch.search();
        }
      });
    })();
  </script>

</dom-module>
