<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">

<link id="bible-reference-parser" rel="import" href="../utils/bible-reference-parser.html">

<dom-module id="card-quick-nav">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host{
        display: block;
      }
      paper-card {
        display: block;
      }
      #card .card-content{
        padding-top: 0px;
        margin-top: -20px;
      }
    </style>

    <paper-card id="card" heading="Quick Navigation">
      <div class="card-content">
        <paper-input error-message="Reference not recognized, format should be like `Mt 1:1` or `Matthew 1:1`" invalid="{{invalid}}" label="Enter a bible reference and hit enter..." on-keyup="checkForEnter"></paper-input>
      </div>
    </paper-card>

  </template>

  <script>
    (function() {
      'use strict';

      //var BibleReferencePromise = new Promise(function(resolve, reject) {
        //require(['/elements/utils/bible-reference-parser.js'], resolve, reject);
      //});

      var BibleReference = require('bible-reference-parser');

      Polymer({
        is: 'card-quick-nav',
        ready: function(){

        },
        checkForEnter: function(ev){
          this.invalid = false;
          if(ev.keyCode == 13){
            //BibleReferencePromise.then(function(BibleReference){
            //  alert(BibleReference);
            var reference = new BibleReference(ev.target.value);
            if(reference.book){
              ev.target.blur();
              page('/book/'+reference.toString());
            }else{
              this.invalid = true;
            }
            //}.bind(this));
          }
        }
      });

    })();
  </script>

</dom-module>
